<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web Đánh Giá Checklist</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    h2 { color: #333; }
    label { display: block; margin: 5px 0; }
    .result { margin-top: 20px; font-size: 18px; font-weight: bold; }
    .hidden { display: none; }
    select, input[type="date"] { padding: 5px; margin-bottom: 15px; font-size: 16px; }
    button { padding: 8px 12px; margin-top: 10px; font-size: 16px; cursor: pointer; }
    table { margin-top: 20px; width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h2>Đánh Giá Checklist Cá Nhân</h2>

  <label for="category">Chọn nhóm checklist:</label>
  <select id="category">
    <option value="">-- Chọn nhóm --</option>
    <option value="chamCoThe">1. Chăm Cơ Thể</option>
    <option value="chamNhaCua">2. Chăm Nhà Cửa</option>
    <option value="dinhDuong">3. Dinh Dưỡng – Ẩm Thực</option>
    <option value="langPhi">4. Kiểm Soát Lãng Phí</option>
    <option value="aura">5. Nâng Tầng Aura</option>
    <option value="soThich">6. Sở Thích – Dưỡng Khí</option>
    <option value="theDuc">7. Thể Dục – Cơ Xương – Dáng Form</option>
  </select>

  <label for="date">Chọn ngày đánh giá:</label>
  <input type="date" id="date" value="">

  <form id="checklist-form"></form>

  <div class="result">
    Đã hoàn thành: <span id="count">0</span>/<span id="total">0</span><br>
    Hoàn thành: <span id="percent">0%</span><br>
    Xếp loại: <span id="rank">Chưa xác định</span><br>
    <button id="saveBtn">Lưu kết quả</button>
  </div>

  <h3>Lịch sử đánh giá</h3>
  <table id="historyTable">
    <thead>
      <tr>
        <th>Ngày</th>
        <th>Nhóm</th>
        <th>Hoàn thành</th>
        <th>Tổng</th>
        <th>%</th>
        <th>Xếp loại</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const checklistData = {/* giữ nguyên như lần trước */};

    const form = document.getElementById('checklist-form');
    const countEl = document.getElementById('count');
    const totalEl = document.getElementById('total');
    const percentEl = document.getElementById('percent');
    const rankEl = document.getElementById('rank');
    const saveBtn = document.getElementById('saveBtn');
    const historyTable = document.getElementById('historyTable').querySelector('tbody');

    const categorySelector = document.getElementById('category');
    const dateInput = document.getElementById('date');

    // Mặc định ngày hôm nay
    dateInput.valueAsDate = new Date();

    categorySelector.addEventListener('change', renderChecklist);
    form.addEventListener('change', updateStats);
    saveBtn.addEventListener('click', saveResult);

    function renderChecklist() {
      const group = categorySelector.value;
      form.innerHTML = '';
      if (!group || !checklistData[group]) return;
      checklistData[group].forEach((item, i) => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" data-id="${i}"> ${item}`;
        form.appendChild(label);
      });
      updateStats();
    }

    function updateStats() {
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      const total = checkboxes.length;
      let checked = 0;
      checkboxes.forEach(cb => { if (cb.checked) checked++; });
      const percent = total ? Math.round((checked / total) * 100) : 0;
      let rank = 'Chưa xác định';
      if (percent >= 80) rank = 'Hoàn thành tốt';
      else if (percent >= 60) rank = 'Tạm ổn';
      else rank = 'Cần cải thiện';

      countEl.textContent = checked;
      totalEl.textContent = total;
      percentEl.textContent = percent + '%';
      rankEl.textContent = rank;
    }

    function saveResult(e) {
      e.preventDefault();
      const group = categorySelector.value;
      const date = dateInput.value;
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      if (!group || !date || checkboxes.length === 0) return;

      const total = checkboxes.length;
      let checked = 0;
      checkboxes.forEach(cb => { if (cb.checked) checked++; });
      const percent = total ? Math.round((checked / total) * 100) : 0;
      let rank = 'Chưa xác định';
      if (percent >= 80) rank = 'Hoàn thành tốt';
      else if (percent >= 60) rank = 'Tạm ổn';
      else rank = 'Cần cải thiện';

      const history = JSON.parse(localStorage.getItem('checklistHistory') || '[]');
      history.push({ date, group, checked, total, percent, rank });
      localStorage.setItem('checklistHistory', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('checklistHistory') || '[]');
      historyTable.innerHTML = '';
      history.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.date}</td>
          <td>${getGroupLabel(item.group)}</td>
          <td>${item.checked}</td>
          <td>${item.total}</td>
          <td>${item.percent}%</td>
          <td>${item.rank}</td>
        `;
        historyTable.appendChild(row);
      });
    }

    function getGroupLabel(key) {
      const map = {
        chamCoThe: 'Chăm Cơ Thể',
        chamNhaCua: 'Chăm Nhà Cửa',
        dinhDuong: 'Dinh Dưỡng',
        langPhi: 'Kiểm Soát Lãng Phí',
        aura: 'Nâng Tầng Aura',
        soThich: 'Sở Thích',
        theDuc: 'Thể Dục – Cơ Xương'
      };
      return map[key] || key;
    }

    // Khởi tạo bảng lịch sử nếu có dữ liệu
    renderHistory();
  </script>
</body>
</html>
