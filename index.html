<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web ƒê√°nh Gi√° Checklist</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f5f8fa; margin: 0; padding: 30px; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    h2 { color: #333; margin-top: 0; }
    h3 { color: #4caf50; margin-top: 30px; }
    label { display: block; margin: 8px 0; }
    select, button, #datePicker { padding: 8px 12px; font-size: 16px; margin-bottom: 10px; }
    #datePicker { border: 1px solid #ccc; border-radius: 8px; font-family: 'Segoe UI', Roboto, sans-serif; background-repeat: no-repeat; background-position: right 10px center; background-size: 16px 16px; padding-right: 32px; background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3E%F0%9F%93%85%3C/text%3E%3C/svg%3E"); }
    #datePicker:hover, #datePicker:focus { border-color: #4CAFEF; outline: none; }
    button { background-color: #4caf50; color: #fff; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
    button:hover { background-color: #43a047; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px 10px; text-align: left; }
    th { background-color: #c8e6c9; }
    .result { margin-top: 20px; font-size: 18px; font-weight: bold; }
    .hidden { display: none; }
    label.checked { background-color: #e0ffe0; color: #2e7d32; animation: fade-in 0.3s; }
    .flatpickr-day.complete { background-color: #b2f2bb; color: #000; }
    .flatpickr-day.incomplete { background-color: #ffe6e6; color: #000; }
    #compareChart { max-height: 300px; }
    .progress { width: 100%; height: 20px; background-color: #e0e0e0; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
    .progress div { height: 100%; background-color: #4caf50; text-align: center; color: #fff; line-height: 20px; font-weight: bold; }
    .actions { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
    .date-picker { padding: 8px; border: 1px solid #ccc; border-radius: 8px; transition: border-color 0.2s; }
    .date-picker:hover, .date-picker:focus { border-color: #4CAFEF; outline: none; }
    .action-btn { background-color: #4CAF50; color: #fff; padding: 8px 14px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; margin-right: 8px; }
    .action-btn:hover { background-color: #43A047; box-shadow: 0 2px 4px rgba(0,0,0,0.2);}
    .actions .action-btn:last-child { margin-right: 0; }
    .bars { display: flex; gap: 10px; margin-bottom: 20px; }
    .bar { flex: 1; background: #eee; border-radius: 6px; position: relative; height: 24px; margin: 0 5px; }
    .bar span { position: absolute; left: 8px; top: 0; font-size: 12px; color: #000; line-height: 24px; z-index: 2; }
    .fill { height: 100%; border-radius: 6px; transition: width 0.3s; }
    #energyBar { background: #FFD700; }
    #moodBar { background: #4DB6E2; }
    #auraBar { background: #B388EB; }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>
  <div class="container">
    <h2>ƒê√°nh Gi√° Checklist C√° Nh√¢n</h2>
    <div class="bars">
      <div class="bar"><span>Energy ‚ö°</span><div class="fill" id="energyBar"></div></div>
      <div class="bar"><span>Mood üòä</span><div class="fill" id="moodBar"></div></div>
      <div class="bar"><span>Aura ‚ú®</span><div class="fill" id="auraBar"></div></div>
    </div>
    <label for="category">Ch·ªçn nh√≥m checklist:</label>
    <select id="category" multiple>
      <option value="">-- Ch·ªçn nh√≥m --</option>
      <option value="chamCoThe">1. üèãÔ∏è ChƒÉm C∆° Th·ªÉ</option>
      <option value="chamNhaCua">2. üè† ChƒÉm Nh√† C·ª≠a</option>
      <option value="dinhDuong">3. üçé Dinh D∆∞·ª°ng ‚Äì ·∫®m Th·ª±c</option>
      <option value="langPhi">4. üí∞ Ki·ªÉm So√°t L√£ng Ph√≠</option>
      <option value="aura">5. ‚ú® N√¢ng T·∫ßng Aura</option>
      <option value="soThich">6. üé≠ S·ªü Th√≠ch ‚Äì D∆∞·ª°ng Kh√≠</option>
      <option value="theDuc">7. üèÉ Th·ªÉ D·ª•c ‚Äì C∆° X∆∞∆°ng ‚Äì D√°ng Form</option>
    </select>
    <canvas id="compareChart" class="hidden"></canvas>
    <div id="progressContainer" class="progress hidden"><div id="progressBar"></div></div>
    <div class="actions">
      <input type="text" id="datePicker" class="date-picker" readonly />
      <button class="action-btn" onclick="saveProgress()">L∆∞u k·∫øt qu·∫£</button>
      <button class="action-btn" onclick="triggerImport()">Nh·∫≠p d·ªØ li·ªáu</button>
      <input type="file" id="import-file" accept=".json" class="hidden" />
      <button class="action-btn" onclick="undoChange()">Ho√†n t√°c</button>
    </div>
    <h3 id="checklist-title"></h3>
    <form id="checklist-form"></form>
    <div class="result checklist-summary">
      <div><strong>Ng√†y:</strong> <span id="date"></span></div>
      <div><strong>ƒê√£ ho√†n th√†nh:</strong> <span id="count">0</span>/<span id="total">0</span></div>
      <div><strong>X·∫øp lo·∫°i:</strong> <span id="rank" class="grade">Ch∆∞a x√°c ƒë·ªãnh</span></div>
      <p id="motivation" class="motivational"></p>
    </div>
    <div id="storyBox"><div id="storyMessages"></div></div>
    <div id="snippet" class="snippet"></div>
    <div id="milestoneModal" class="modal hidden">
      <div class="modal-content">
        <div class="icon">üéâ</div>
        <p id="milestoneText"></p>
        <button id="closeModal">ƒê√≥ng</button>
        <div id="milestoneStoryMessages"></div>
      </div>
    </div>
    <!-- X√ìA b·∫£ng th√†nh t·ª±u -->
    <!-- <h3>üìñ Th√†nh t·ª±u</h3>
    <table id="history-table">
      <thead>
        <tr><th>Ng√†y</th><th>Nh√≥m</th><th>Ho√†n th√†nh</th><th>X·∫øp lo·∫°i</th></tr>
      </thead>
      <tbody></tbody>
    </table> -->
  </div>
<script>
const checklistData = {
  chamCoThe: [
    "U·ªëng ƒë·ªß 1.5 ‚Äì 2L n∆∞·ªõc (chia 3 khung s√°ng ‚Äì chi·ªÅu ‚Äì t·ªëi)",
    "R·ª≠a m·∫∑t s√°ng + t·ªëi",
    "Thoa lotion body (c·ªï ‚Äì vai ‚Äì tay ‚Äì ch√¢n)",
    "Ch·∫£i t√≥c ‚Äì x·ªãt d∆∞·ª°ng ·∫©m ng·ªçn t√≥c (n·∫øu t√≥c kh√¥)",
    "ƒê√°nh rƒÉng 2 l·∫ßn/ng√†y",
    "T·∫©y trang / lau s·∫°ch m·∫∑t n·∫øu d√πng kem ch·ªëng n·∫Øng ho·∫∑c ƒëi ra ngo√†i",
    "L√†m s·∫°ch m√¥i ‚Äì d∆∞·ª°ng m√¥i",
    "T·∫Øm n∆∞·ªõc ·∫•m bu·ªïi t·ªëi (x·∫£ stress, reset da)",
    "D∆∞·ª°ng da body t·ªëi (n·∫øu kh√¥ng m·ªát)",
    "K√©o gi√£n ch√¢n, g·∫≠p b·ª•ng nh·∫π 3‚Äì5 ph√∫t (n·∫øu ng·ªìi l√¢u)"
  ],
  chamNhaCua: [
    "X·∫øp chƒÉn g·ªçn sau khi ng·ªß d·∫≠y",
    "R·ª≠a ch√©n b√°t trong ng√†y (kh√¥ng ƒë·ªÉ t·ªìn qua ƒë√™m)",
    "Qu√©t nh√† ho·∫∑c lau ch√πi ƒëi·ªÉm b·∫©n r√µ r·ªát",
    "Kh√¥ng ƒë·ªÉ ƒë·ªì lung tung d∆∞·ªõi ƒë·∫•t",
    "D·ªçn ƒë·ªì tr√™n b√†n v·ªÅ ƒë√∫ng g√≥c / v·ªã tr√≠",
    "ƒê·ªï r√°c (t·ªëi)"
  ],
  dinhDuong: [
    "1 c·ªëc n∆∞·ªõc l·ªçc ngay sau khi ng·ªß d·∫≠y",
    "U·ªëng n∆∞·ªõc 1.5‚Äì2L chia s√°ng/chi·ªÅu/t·ªëi",
    "2‚Äì3 b·ªØa ch√≠nh: ƒë·∫ßy ƒë·ªß carb t·ªët + ƒë·∫°m + rau",
    "1‚Äì2 b·ªØa ph·ª• nh·∫π: s·ªØa h·∫°t / tr√°i c√¢y / h·∫°t mix",
    "1 b·ªØa c√≥ rau xanh d·∫°ng l√° (gi√∫p ti√™u h√≥a)",
    "1‚Äì2 b·ªØa c√≥ tr√°i c√¢y t∆∞∆°i",
    "1 b·ªØa c√≥ protein tr·∫Øng (c√°, g√†, tr·ª©ng)",
    "Tr√°nh ƒë·ªÉ qu√° 6 ti·∫øng kh√¥ng ƒÉn",
    "Kh√¥ng ƒÉn khuya sau 9h t·ªëi (tr·ª´ khi t·∫≠p n·∫∑ng)"
  ],
  langPhi: [
    "Kh√¥ng mua ƒë·ªì kh√¥ng c·∫ßn thi·∫øt",
    "Kh√¥ng ti√™u ti·ªÅn cho th√≥i quen x·∫•u",
    "Ki·ªÉm tra v√≠ tr∆∞·ªõc khi ra ngo√†i",
    "Ghi ch√∫ chi ti√™u trong ng√†y"
  ],
  aura: [
    "Thi·ªÅn ho·∫∑c th·ªü s√¢u 5 ph√∫t",
    "ƒê·ªçc s√°ch ph√°t tri·ªÉn b·∫£n th√¢n",
    "Vi·∫øt nh·∫≠t k√Ω c·∫£m x√∫c",
    "Nghe nh·∫°c th∆∞ gi√£n"
  ],
  soThich: [
    "V·∫Ω/trang tr√≠/vi·∫øt l√°ch",
    "Ch∆°i nh·∫°c c·ª• ho·∫∑c nghe nh·∫°c",
    "T·∫≠p th·ªÉ thao nh·∫π nh√†ng",
    "ChƒÉm s√≥c c√¢y c·∫£nh/th√∫ c∆∞ng"
  ],
  theDuc: [
    "Kh·ªüi ƒë·ªông 5 ph√∫t",
    "T·∫≠p th·ªÉ d·ª•c √≠t nh·∫•t 15 ph√∫t",
    "ƒêi b·ªô 5000 b∆∞·ªõc tr·ªü l√™n",
    "Gi√£n c∆° sau t·∫≠p"
  ]
};

const checklistValues = {
  "U·ªëng ƒë·ªß 1.5 ‚Äì 2L n∆∞·ªõc (chia 3 khung s√°ng ‚Äì chi·ªÅu ‚Äì t·ªëi)": { energy: 10, mood: 0, aura: 0 },
  "R·ª≠a m·∫∑t s√°ng + t·ªëi": { energy: 5, mood: 0, aura: 5 },
  "Thoa lotion body (c·ªï ‚Äì vai ‚Äì tay ‚Äì ch√¢n)": { energy: 3, mood: 2, aura: 2 },
  "Ch·∫£i t√≥c ‚Äì x·ªãt d∆∞·ª°ng ·∫©m ng·ªçn t√≥c (n·∫øu t√≥c kh√¥)": { energy: 2, mood: 2, aura: 1 },
  "ƒê√°nh rƒÉng 2 l·∫ßn/ng√†y": { energy: 3, mood: 1, aura: 1 },
  "T·∫©y trang / lau s·∫°ch m·∫∑t n·∫øu d√πng kem ch·ªëng n·∫Øng ho·∫∑c ƒëi ra ngo√†i": { energy: 2, mood: 1, aura: 2 },
  "L√†m s·∫°ch m√¥i ‚Äì d∆∞·ª°ng m√¥i": { energy: 1, mood: 1, aura: 2 },
  "T·∫Øm n∆∞·ªõc ·∫•m bu·ªïi t·ªëi (x·∫£ stress, reset da)": { energy: 4, mood: 3, aura: 3 },
  "D∆∞·ª°ng da body t·ªëi (n·∫øu kh√¥ng m·ªát)": { energy: 2, mood: 2, aura: 2 },
  "K√©o gi√£n ch√¢n, g·∫≠p b·ª•ng nh·∫π 3‚Äì5 ph√∫t (n·∫øu ng·ªìi l√¢u)": { energy: 2, mood: 2, aura: 1 },
  "Kh√¥ng mua ƒë·ªì kh√¥ng c·∫ßn thi·∫øt": { energy: 0, mood: 0, aura: 5 },
  "Kh√¥ng ti√™u ti·ªÅn cho th√≥i quen x·∫•u": { energy: 0, mood: 0, aura: 5 },
  "Ki·ªÉm tra v√≠ tr∆∞·ªõc khi ra ngo√†i": { energy: 0, mood: 0, aura: 2 },
  "Ghi ch√∫ chi ti√™u trong ng√†y": { energy: 0, mood: 0, aura: 3 },
  "Thi·ªÅn ho·∫∑c th·ªü s√¢u 5 ph√∫t": { energy: 0, mood: 5, aura: 5 },
  "ƒê·ªçc s√°ch ph√°t tri·ªÉn b·∫£n th√¢n": { energy: 0, mood: 3, aura: 5 },
  "Vi·∫øt nh·∫≠t k√Ω c·∫£m x√∫c": { energy: 0, mood: 4, aura: 4 },
  "Nghe nh·∫°c th∆∞ gi√£n": { energy: 0, mood: 5, aura: 3 },
  "V·∫Ω/trang tr√≠/vi·∫øt l√°ch": { energy: 0, mood: 4, aura: 4 },
  "Ch∆°i nh·∫°c c·ª• ho·∫∑c nghe nh·∫°c": { energy: 0, mood: 5, aura: 3 },
  "T·∫≠p th·ªÉ thao nh·∫π nh√†ng": { energy: 0, mood: 3, aura: 2 },
  "ChƒÉm s√≥c c√¢y c·∫£nh/th√∫ c∆∞ng": { energy: 0, mood: 4, aura: 3 },
  "Kh·ªüi ƒë·ªông 5 ph√∫t": { energy: 5, mood: 0, aura: 0 },
  "T·∫≠p th·ªÉ d·ª•c √≠t nh·∫•t 15 ph√∫t": { energy: 10, mood: 0, aura: 0 },
  "ƒêi b·ªô 5000 b∆∞·ªõc tr·ªü l√™n": { energy: 8, mood: 0, aura: 0 },
  "Gi√£n c∆° sau t·∫≠p": { energy: 2, mood: 0, aura: 0 }
};

const storyBank = [
  "M·ªôt l√†n kh√≠ nh·∫π lan ra quanh b·∫°n.",
  "B·∫°n th·∫•y c∆° th·ªÉ m√¨nh ·∫•m l√™n m·ªôt ch√∫t.",
  "B·∫°n c·∫£m th·∫•y tinh th·∫ßn ph·∫•n ch·∫•n h∆°n.",
  "B·∫°n v·ª´a ho√†n th√†nh m·ªôt b∆∞·ªõc nh·ªè cho b·∫£n th√¢n.",
  "B·∫°n ƒë√£ chƒÉm s√≥c t·ªët cho ch√≠nh m√¨nh h√¥m nay."
];
const milestoneBank = [
  "C∆° th·ªÉ n√†y nh∆∞ v·ª´a ƒë∆∞·ª£c reset.",
  "CƒÉn ph√≤ng n√†y gi·ªù th·ªü c√πng b·∫°n.",
  "B·∫°n ƒë√£ ƒë·∫°t m·ªôt c·ªôt m·ªëc m·ªõi!",
  "B·∫°n x·ª©ng ƒë√°ng v·ªõi th√†nh t·ª±u n√†y!"
];

// --- Bi·∫øn to√†n c·ª•c ---
let selectedGroups = [];
let currentGroup = "";
let choicesInstance;
let compareChart;
const categorySelect = document.getElementById('category');

// --- Thanh tr·∫°ng th√°i ---
// Reset v·ªÅ 0 m·ªói ng√†y, c·ªông d·∫ßn khi tick checklist
const stats = { energy: 0, mood: 0, aura: 0 };
let statsDate = ""; // ng√†y hi·ªán t·∫°i c·ªßa thanh bar

function getTodayStr() {
  // ƒê·∫£m b·∫£o format gi·ªëng flatpickr (dd/mm/yyyy)
  const d = new Date();
  return d.toLocaleDateString('vi-VN');
}

function loadStats(){
  const today = getTodayStr();
  const saved = localStorage.getItem('simStats');
  let s = { energy: 0, mood: 0, aura: 0, date: today };
  if(saved){
    try {
      s = JSON.parse(saved);
    } catch {}
  }
  // N·∫øu kh√°c ng√†y th√¨ reset v·ªÅ 0
  if (s.date !== today) {
    stats.energy = 0; stats.mood = 0; stats.aura = 0;
    statsDate = today;
    saveStats();
    // Reset t·∫•t c·∫£ checklist ƒë√£ tick cho ng√†y m·ªõi
    Object.keys(checklistData).forEach(group => {
      localStorage.removeItem('progress_' + group);
    });
    if (currentGroup) renderChecklist(currentGroup);
  } else {
    stats.energy = s.energy || 0;
    stats.mood = s.mood || 0;
    stats.aura = s.aura || 0;
    statsDate = s.date || today;
  }
  updateBars();
}

function saveStats(){
  const today = getTodayStr();
  localStorage.setItem('simStats', JSON.stringify({
    energy: stats.energy,
    mood: stats.mood,
    aura: stats.aura,
    date: today
  }));
}

function updateBars(){
  // N·∫øu gi√° tr·ªã l√† 0 th√¨ bar s·∫Ω kh√¥ng hi·ªán (·∫©n fill)
  const energyBar = document.getElementById('energyBar');
  const moodBar = document.getElementById('moodBar');
  const auraBar = document.getElementById('auraBar');
  energyBar.style.width = stats.energy > 0 ? stats.energy + '%' : '0%';
  moodBar.style.width = stats.mood > 0 ? stats.mood + '%' : '0%';
  auraBar.style.width = stats.aura > 0 ? stats.aura + '%' : '0%';
  energyBar.style.background = stats.energy > 0 ? "#FFD700" : "transparent";
  moodBar.style.background = stats.mood > 0 ? "#4DB6E2" : "transparent";
  auraBar.style.background = stats.aura > 0 ? "#B388EB" : "transparent";
}

// --- Hi·ªáu ·ª©ng story ---
function fadeSnippet(text){
  const snippetDiv = document.getElementById('snippet');
  snippetDiv.style.opacity=0;
  setTimeout(()=>{snippetDiv.textContent=text; snippetDiv.style.opacity=1;},50);
}

// --- Modal th√†nh t·ª±u ---
const modal = document.getElementById('milestoneModal');
const milestoneText = document.getElementById('milestoneText');
document.getElementById('closeModal').addEventListener('click',()=>modal.classList.add('hidden'));

// --- Render checklist ---
function renderChecklist(group) {
  const checklistDiv = document.getElementById('checklist-form');
  checklistDiv.innerHTML = '';
  fadeSnippet('');
  if (!group || !checklistData[group]) {
    updateSummary(0, 0, "Ch∆∞a x√°c ƒë·ªãnh", "");
    return;
  }
  const items = checklistData[group];
  let currentValues = JSON.parse(localStorage.getItem('progress_' + group) || '[]');
  if (currentValues.length !== items.length) currentValues = items.map(() => false);
  items.forEach((item, idx) => {
    const label = document.createElement('label');
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = currentValues[idx];
    if (cb.checked) label.classList.add('checked');
    cb.addEventListener('change', () => {
      currentValues[idx] = cb.checked;
      label.classList.toggle('checked', cb.checked);
      localStorage.setItem('progress_' + group, JSON.stringify(currentValues));
      onChecklistToggle(item, cb.checked, group, idx, label);
      updateChecklistSummary(group, items, currentValues);
    });
    label.appendChild(cb);
    label.append(' ' + item);
    checklistDiv.appendChild(label);
  });
  updateChecklistSummary(group, items, currentValues);
}

// --- Khi tick checklist ---
function onChecklistToggle(item, checked, group, idx, label) {
  const val = checklistValues[item] || { energy: 0, mood: 0, aura: 0 };
  if (checked) {
    stats.energy = Math.min(100, stats.energy + val.energy);
    stats.mood = Math.min(100, stats.mood + val.mood);
    stats.aura = Math.min(100, stats.aura + val.aura);
    fadeSnippet(storyBank[Math.floor(Math.random() * storyBank.length)]);
  } else {
    stats.energy = Math.max(0, stats.energy - val.energy);
    stats.mood = Math.max(0, stats.mood - val.mood);
    stats.aura = Math.max(0, stats.aura - val.aura);
  }
  saveStats();
  updateBars();
  const progress = JSON.parse(localStorage.getItem('progress_' + group) || '[]');
  if (progress.length && progress.every(v => v)) {
    milestoneText.textContent = milestoneBank[Math.floor(Math.random() * milestoneBank.length)];
    modal.classList.remove('hidden');
  }
}

// --- ƒê·ªìng b·ªô checklist summary ---
function updateChecklistSummary(group, items, values) {
  const count = values.filter(Boolean).length;
  const total = items.length;
  const rank = getRank(count, total);
  const motivation = getMotivation(rank);
  updateSummary(count, total, rank, motivation);
  // Kh√¥ng g·ªçi saveHistory n·ªØa v√¨ ƒë√£ x√≥a b·∫£ng th√†nh t·ª±u
}

// --- C·∫≠p nh·∫≠t v√πng summary ---
function updateSummary(count, total, rank, motivation) {
  document.getElementById('count').textContent = count;
  document.getElementById('total').textContent = total;
  document.getElementById('rank').textContent = rank;
  document.getElementById('motivation').textContent = motivation;
  document.getElementById('date').textContent = (new Date()).toLocaleDateString('vi-VN');
}

// --- X·∫øp lo·∫°i ---
function getRank(count, total) {
  if (total === 0) return "Ch∆∞a x√°c ƒë·ªãnh";
  const ratio = count / total;
  if (ratio === 1) return "Xu·∫•t s·∫Øc";
  if (ratio >= 0.8) return "T·ªët";
  if (ratio >= 0.5) return "Trung b√¨nh";
  if (ratio > 0) return "C·∫ßn c·ªë g·∫Øng";
  return "Ch∆∞a l√†m";
}

// --- ƒê·ªông l·ª±c ---
function getMotivation(rank) {
  switch(rank) {
    case "Xu·∫•t s·∫Øc": return "Tuy·ªát v·ªùi! B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc checklist h√¥m nay!";
    case "T·ªët": return "R·∫•t t·ªët! H√£y c·ªë g·∫Øng th√™m ƒë·ªÉ ƒë·∫°t m·ª©c xu·∫•t s·∫Øc.";
    case "Trung b√¨nh": return "B·∫°n ƒëang ƒëi ƒë√∫ng h∆∞·ªõng, ti·∫øp t·ª•c ph√°t huy nh√©!";
    case "C·∫ßn c·ªë g·∫Øng": return "ƒê·ª´ng b·ªè cu·ªôc, h√£y th·ª≠ l·∫°i v√†o ng√†y mai!";
    case "Ch∆∞a l√†m": return "B·∫Øt ƒë·∫ßu t·ª´ng b∆∞·ªõc nh·ªè, b·∫°n s·∫Ω l√†m ƒë∆∞·ª£c!";
    default: return "";
  }
}

// --- Kh·ªüi t·∫°o ---
document.addEventListener('DOMContentLoaded', function() {
  if (window.Choices) {
    choicesInstance = new Choices(categorySelect, { removeItemButton: true });
    categorySelect.addEventListener('change', handleCategoryChange);
  } else {
    categorySelect.addEventListener('change', handleCategoryChange);
  }
  // Hi·ªÉn th·ªã l·ªãch b·∫±ng flatpickr, lu√¥n hi·ªán
  if (window.flatpickr) {
    flatpickr("#datePicker", {
      dateFormat: "d/m/Y",
      defaultDate: new Date(),
      allowInput: true,
      clickOpens: true,
      onReady: function(selectedDates, dateStr, instance) {
        // Kh√¥ng t·ª± ƒë·ªông m·ªü l·ªãch, ch·ªâ m·ªü khi click
      },
      onChange: function(selectedDates, dateStr) {
        document.getElementById('date').textContent = dateStr;
        // Reset thanh bar khi ƒë·ªïi ng√†y
        stats.energy = 0; stats.mood = 0; stats.aura = 0;
        saveStats();
        updateBars();
        // Reset t·∫•t c·∫£ checklist ƒë√£ tick cho ng√†y m·ªõi
        Object.keys(checklistData).forEach(group => {
          localStorage.removeItem('progress_' + group);
        });
        if (currentGroup) renderChecklist(currentGroup);
      }
    });
  }
  // ƒê·∫£m b·∫£o lu√¥n c√≥ ng√†y hi·ªÉn th·ªã
  if (!document.getElementById('date').textContent) {
    document.getElementById('date').textContent = getTodayStr();
  }
  loadStats();
  // Kh√¥ng g·ªçi renderHistoryTable n·ªØa
});

// --- C√°c n√∫t ch·ª©c nƒÉng ---
function saveProgress() {
  if (typeof currentGroup !== 'undefined' && currentGroup && checklistData[currentGroup]) {
    const items = checklistData[currentGroup];
    const values = JSON.parse(localStorage.getItem('progress_' + currentGroup) || '[]');
    if (values.some(Boolean)) {
      alert('ƒê√£ l∆∞u k·∫øt qu·∫£ cho ng√†y h√¥m nay!');
    } else {
      alert('B·∫°n ch∆∞a ho√†n th√†nh m·ª•c n√†o trong nh√≥m n√†y.');
    }
  } else {
    alert('Vui l√≤ng ch·ªçn m·ªôt nh√≥m checklist v√† th·ª±c hi·ªán √≠t nh·∫•t m·ªôt m·ª•c tr∆∞·ªõc khi l∆∞u.');
  }
}
function triggerImport() {
  document.getElementById('import-file').click();
}
function undoChange() {
  if (currentGroup) {
    localStorage.removeItem('progress_' + currentGroup);
    renderChecklist(currentGroup);
  }
}

// --- S·ª± ki·ªán ch·ªçn nh√≥m checklist ---
function handleCategoryChange() {
  if (window.Choices && choicesInstance) {
    selectedGroups = choicesInstance.getValue(true);
    if (selectedGroups.length === 1) {
      document.getElementById('compareChart').classList.add('hidden');
      currentGroup = selectedGroups[0];
      renderChecklist(currentGroup);
    } else if (selectedGroups.length > 1) {
      document.getElementById('checklist-form').innerHTML = '';
      document.getElementById('snippet').textContent = '';
      renderCompareChart(selectedGroups);
      updateSummary(0, 0, "Ch∆∞a x√°c ƒë·ªãnh", "");
    } else {
      document.getElementById('compareChart').classList.add('hidden');
      document.getElementById('checklist-form').innerHTML = '';
      updateSummary(0, 0, "Ch∆∞a x√°c ƒë·ªãnh", "");
    }
  } else {
    currentGroup = categorySelect.value || categorySelect.options[categorySelect.selectedIndex].value;
    document.getElementById('compareChart').classList.add('hidden');
    renderChecklist(currentGroup);
  }
}
</script>
</body>
</html>
